var cov_mlci9cwpp=function(){var path='/Users/codifycodify/Documents/GitHub/challenge-git/lib/server.js',hash='99236c3b7720195482bf774f65a47f0ba547c326',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/codifycodify/Documents/GitHub/challenge-git/lib/server.js',statementMap:{'0':{start:{line:1,column:10},end:{line:1,column:24}},'1':{start:{line:2,column:11},end:{line:2,column:26}},'2':{start:{line:3,column:11},end:{line:3,column:26}},'3':{start:{line:4,column:14},end:{line:4,column:32}},'4':{start:{line:5,column:15},end:{line:5,column:40}},'5':{start:{line:6,column:16},end:{line:6,column:37}},'6':{start:{line:7,column:18},end:{line:7,column:40}},'7':{start:{line:8,column:21},end:{line:8,column:48}},'8':{start:{line:10,column:9},end:{line:10,column:24}},'9':{start:{line:11,column:10},end:{line:11,column:26}},'10':{start:{line:12,column:14},end:{line:12,column:34}},'11':{start:{line:13,column:14},end:{line:13,column:48}},'12':{start:{line:15,column:13},end:{line:15,column:29}},'13':{start:{line:16,column:13},end:{line:16,column:44}},'14':{start:{line:17,column:13},end:{line:17,column:62}},'15':{start:{line:18,column:11},end:{line:21,column:2}},'16':{start:{line:23,column:0},end:{line:23,column:33}},'17':{start:{line:24,column:0},end:{line:24,column:29}},'18':{start:{line:25,column:0},end:{line:25,column:42}},'19':{start:{line:26,column:0},end:{line:26,column:57}},'20':{start:{line:27,column:0},end:{line:27,column:58}},'21':{start:{line:28,column:0},end:{line:28,column:68}},'22':{start:{line:30,column:0},end:{line:32,column:1}},'23':{start:{line:31,column:2},end:{line:31,column:41}},'24':{start:{line:35,column:2},end:{line:35,column:52}},'25':{start:{line:35,column:29},end:{line:35,column:52}},'26':{start:{line:36,column:2},end:{line:36,column:17}},'27':{start:{line:37,column:2},end:{line:40,column:4}},'28':{start:{line:38,column:4},end:{line:38,column:43}},'29':{start:{line:39,column:4},end:{line:39,column:21}},'30':{start:{line:41,column:2},end:{line:41,column:78}},'31':{start:{line:45,column:2},end:{line:45,column:18}},'32':{start:{line:45,column:12},end:{line:45,column:18}},'33':{start:{line:47,column:2},end:{line:47,column:40}},'34':{start:{line:48,column:2},end:{line:48,column:25}},'35':{start:{line:50,column:2},end:{line:52,column:4}},'36':{start:{line:56,column:2},end:{line:56,column:45}},'37':{start:{line:56,column:39},end:{line:56,column:45}},'38':{start:{line:58,column:16},end:{line:58,column:56}},'39':{start:{line:60,column:2},end:{line:64,column:17}},'40':{start:{line:68,column:2},end:{line:68,column:20}},'41':{start:{line:69,column:2},end:{line:69,column:11}},'42':{start:{line:73,column:2},end:{line:73,column:35}}},fnMap:{'0':{name:'createServer',decl:{start:{line:30,column:26},end:{line:30,column:38}},loc:{start:{line:30,column:42},end:{line:32,column:1}},line:30},'1':{name:'handler',decl:{start:{line:34,column:9},end:{line:34,column:16}},loc:{start:{line:34,column:28},end:{line:42,column:1}},line:34},'2':{name:'(anonymous_2)',decl:{start:{line:37,column:42},end:{line:37,column:43}},loc:{start:{line:37,column:58},end:{line:40,column:3}},line:37},'3':{name:'onError',decl:{start:{line:44,column:9},end:{line:44,column:16}},loc:{start:{line:44,column:33},end:{line:53,column:1}},line:44},'4':{name:'logError',decl:{start:{line:55,column:9},end:{line:55,column:17}},loc:{start:{line:55,column:34},end:{line:65,column:1}},line:55},'5':{name:'empty',decl:{start:{line:67,column:9},end:{line:67,column:14}},loc:{start:{line:67,column:26},end:{line:70,column:1}},line:67},'6':{name:'getQuery',decl:{start:{line:72,column:9},end:{line:72,column:17}},loc:{start:{line:72,column:24},end:{line:74,column:1}},line:72}},branchMap:{'0':{loc:{start:{line:35,column:2},end:{line:35,column:52}},type:'if',locations:[{start:{line:35,column:2},end:{line:35,column:52}},{start:{line:35,column:2},end:{line:35,column:52}}],line:35},'1':{loc:{start:{line:38,column:22},end:{line:38,column:36}},type:'binary-expr',locations:[{start:{line:38,column:22},end:{line:38,column:30}},{start:{line:38,column:34},end:{line:38,column:36}}],line:38},'2':{loc:{start:{line:45,column:2},end:{line:45,column:18}},type:'if',locations:[{start:{line:45,column:2},end:{line:45,column:18}},{start:{line:45,column:2},end:{line:45,column:18}}],line:45},'3':{loc:{start:{line:47,column:19},end:{line:47,column:40}},type:'binary-expr',locations:[{start:{line:47,column:19},end:{line:47,column:33}},{start:{line:47,column:37},end:{line:47,column:40}}],line:47},'4':{loc:{start:{line:51,column:11},end:{line:51,column:59}},type:'binary-expr',locations:[{start:{line:51,column:11},end:{line:51,column:22}},{start:{line:51,column:26},end:{line:51,column:59}}],line:51},'5':{loc:{start:{line:56,column:2},end:{line:56,column:45}},type:'if',locations:[{start:{line:56,column:2},end:{line:56,column:45}},{start:{line:56,column:2},end:{line:56,column:45}}],line:56},'6':{loc:{start:{line:58,column:16},end:{line:58,column:56}},type:'cond-expr',locations:[{start:{line:58,column:40},end:{line:58,column:47}},{start:{line:58,column:50},end:{line:58,column:56}}],line:58}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var URL=(cov_mlci9cwpp.s[0]++,require('url'));var http=(cov_mlci9cwpp.s[1]++,require('http'));var cuid=(cov_mlci9cwpp.s[2]++,require('cuid'));var Corsify=(cov_mlci9cwpp.s[3]++,require('corsify'));var sendJson=(cov_mlci9cwpp.s[4]++,require('send-data/json'));var ReqLogger=(cov_mlci9cwpp.s[5]++,require('req-logger'));var healthPoint=(cov_mlci9cwpp.s[6]++,require('healthpoint'));var HttpHashRouter=(cov_mlci9cwpp.s[7]++,require('http-hash-router'));var db=(cov_mlci9cwpp.s[8]++,require('./db'));var api=(cov_mlci9cwpp.s[9]++,require('./api'));var authify=(cov_mlci9cwpp.s[10]++,require('./authify'));var version=(cov_mlci9cwpp.s[11]++,require('../package.json').version);var router=(cov_mlci9cwpp.s[12]++,HttpHashRouter());var logger=(cov_mlci9cwpp.s[13]++,ReqLogger({version:version}));var health=(cov_mlci9cwpp.s[14]++,healthPoint({version:version},db.healthCheck));var cors=(cov_mlci9cwpp.s[15]++,Corsify({'Access-Control-Allow-Origin':'*','Access-Control-Allow-Headers':'authorization, accept, content-type'}));cov_mlci9cwpp.s[16]++;router.set('/favicon.ico',empty);cov_mlci9cwpp.s[17]++;router.set('/echo',api.echo);cov_mlci9cwpp.s[18]++;router.set('/reverse/:input',api.reverse);cov_mlci9cwpp.s[19]++;router.set('/things/get/:key',{GET:authify(api.get)});cov_mlci9cwpp.s[20]++;router.set('/things/put/:key',{POST:authify(api.put)});cov_mlci9cwpp.s[21]++;router.set('/things/stream/:gte/:lte',{GET:authify(api.stream)});cov_mlci9cwpp.s[22]++;module.exports=function createServer(){cov_mlci9cwpp.f[0]++;cov_mlci9cwpp.s[23]++;return http.createServer(cors(handler));};function handler(req,res){cov_mlci9cwpp.f[1]++;cov_mlci9cwpp.s[24]++;if(req.url==='/health'){cov_mlci9cwpp.b[0][0]++;cov_mlci9cwpp.s[25]++;return health(req,res);}else{cov_mlci9cwpp.b[0][1]++;}cov_mlci9cwpp.s[26]++;req.id=cuid();cov_mlci9cwpp.s[27]++;logger(req,res,{requestId:req.id},function(info){cov_mlci9cwpp.f[2]++;cov_mlci9cwpp.s[28]++;info.authEmail=((cov_mlci9cwpp.b[1][0]++,req.auth)||(cov_mlci9cwpp.b[1][1]++,{})).email;cov_mlci9cwpp.s[29]++;console.log(info);});cov_mlci9cwpp.s[30]++;router(req,res,{query:getQuery(req.url)},onError.bind(null,req,res));}function onError(req,res,err){cov_mlci9cwpp.f[3]++;cov_mlci9cwpp.s[31]++;if(!err){cov_mlci9cwpp.b[2][0]++;cov_mlci9cwpp.s[32]++;return;}else{cov_mlci9cwpp.b[2][1]++;}cov_mlci9cwpp.s[33]++;res.statusCode=(cov_mlci9cwpp.b[3][0]++,err.statusCode)||(cov_mlci9cwpp.b[3][1]++,500);cov_mlci9cwpp.s[34]++;logError(req,res,err);cov_mlci9cwpp.s[35]++;sendJson(req,res,{error:(cov_mlci9cwpp.b[4][0]++,err.message)||(cov_mlci9cwpp.b[4][1]++,http.STATUS_CODES[res.statusCode])});}function logError(req,res,err){cov_mlci9cwpp.f[4]++;cov_mlci9cwpp.s[36]++;if(process.env.NODE_ENV==='test'){cov_mlci9cwpp.b[5][0]++;cov_mlci9cwpp.s[37]++;return;}else{cov_mlci9cwpp.b[5][1]++;}var logType=(cov_mlci9cwpp.s[38]++,res.statusCode>=500?(cov_mlci9cwpp.b[6][0]++,'error'):(cov_mlci9cwpp.b[6][1]++,'warn'));cov_mlci9cwpp.s[39]++;console[logType]({err:err,requestId:req.id,statusCode:res.statusCode},err.message);}function empty(req,res){cov_mlci9cwpp.f[5]++;cov_mlci9cwpp.s[40]++;res.writeHead(204);cov_mlci9cwpp.s[41]++;res.end();}function getQuery(url){cov_mlci9cwpp.f[6]++;cov_mlci9cwpp.s[42]++;return URL.parse(url,true).query;}